---
title: "Untitled"
output: html_document
---


# Load libraries



```{r, warning = F, message = F}

library(tidyverse); library(haven); library(lubridate);
library(knitr); library(kableExtra);
library(Hmisc); library(survey)
library(expss); library(here); library(gmodels)
library(flextable); library(formattable)
library(prettydoc); library(officer)

library(tableone); library(sjPlot); 

```


# WS 1.4


```{r}



hl <- read_sav(here("Data/Tunisia_hl.sav")) %>% arrange(HH1, HH2, HL1)

hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% arrange(HH1, HH2)

```


```{r}


hl <- hl %>% mutate(elevel = ifelse(ED5A %in% c(3:4), 3,
                                  ifelse(ED5A %in% c(8:9), 9,
                                         0)))

var_lab(hl$elevel) = "Education"
val_lab(hl$elevel) = make_labels("
  0 None/ECE
  1 Primary
  2 Lower secondary
  3 Upper secondary or higher  
  9 DK/Missing                                
                       
                                 ")
  
  

tmp.person.cwater = hl %>% select(HH1, HH2, HL1, HL4, HL6, elevel) %>% rename(WS5 = HL1)



```



Merge the person collecting the water with the household file. 

```{r}


df = hh %>% left_join(tmp.person.cwater, by = c("HH1", "HH2", "WS5")) %>% 
  filter(HH46 == 1, WS4 > 0) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>%
  mutate(nhhmem = hhweightHH48)


var_lab(df$nhhmem) = "Number of household members without drinking water on premises and where household members are primarily responsible for collecting water"


df <- df %>% 
  mutate(Time = NA) %>% 
  mutate(Time = ifelse(WS4 < 995 & WS6 < 95, floor(WS4 * WS6 / 7), Time)) %>% 
  mutate(Time = ifelse(Time %in% 0:30, 1,
                       ifelse(Time %in% 31:60, 2,
                              ifelse(Time %in% 61:180, 3,
                                     ifelse(Time >= 181, 4, Time)))))

df <- df %>% mutate(averagetime = Time) %>% 
  mutate(averagetime = ifelse(WS4 > 995 | WS6 > 95, 9, averagetime))


df <- df %>% mutate(age1 = ifelse(HL6 %in% 0:14, 1,
                                  ifelse(HL6 %in% 15:49, 3,
                                         ifelse(HL6 %in% 50:95, 4, 9))))

var_lab(df$age1) = "Age"

df = df %>% mutate(age2 = ifelse(HL6 %in% 15:17, 2, age1))

val_lab(df$age1) = make_labels("
1 <15
2 5-14
3 15-49
4 50+
9 DK/Missing
             ")



```


```{r}

source(here("R/drinkingWater.R"))


 

```


# WS 1.5

```{r}



hl <- read_sav(here("Data/Tunisia_hl.sav")) %>% arrange(HH1, HH2, HL1)

hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% filter(HH46 == 1) %>%
  mutate(nhhmem = HH48 * hhweight)


var_lab(hh$nhhmem) = "Number of household members"

source(here("R/drinkingWater.R"))


hh <- hh %>% mutate(sufficentwater = 0) %>% 
  mutate(sufficentwater = ifelse(WS7 == 2, 100, sufficentwater))

var_lab(hh$sufficentwater) = "Percentage of household population with drinking water available in sufficient quantities [1]"


hh <- hh %>% mutate(nmemnotsufficent = ifelse(!is.na(WS8), 1, 0))


var_lab(hh$nmemnotsufficent) = "Number of household members unable to access water in sufficient quantities when needed"

hh <- hh %>% mutate(WS8 = ifelse(WS8 == 8, 9, WS8)); 
val_lab(hh$WS8) = make_labels("
                              9 DK/Missing
                              ")

var_lab(hh$WS8) = "Main reason that the household members are unable to access water in sufficient quantities"

```





# WS 1.6

E. Coli

```{r}



hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% arrange(HH1, HH2) %>% 
  filter(WQ31 == 1) %>% 
  mutate(wqsweightHH48 = 0) %>% 
  mutate(wqsweightHH48 = ifelse(wqsweight > 0, wqsweight * HH48, wqsweightHH48)) %>% 
  mutate(nhhmem = wqsweightHH48)

var_lab(hh$nhhmem) = "Number of household members"


hh <- hh %>% mutate(EC_100_S = NA) %>% 
  mutate(EC_100_S = ifelse(WQ27 < 997 & WQ27 >= 100, 101,
                           ifelse(WQ27 < 101 | WQ27 >= 997, WQ27, EC_100_S)))

hh <- hh %>% mutate(Risk_S = ifelse(EC_100_S %in% 1:10, 1,
                                      ifelse(EC_100_S %in% 11:100, 2,
                                             ifelse(EC_100_S == 101, 3,
                                                    ifelse(EC_100_S >= 102, 9, EC_100_S)))))


var_lab(hh$Risk_S) = "Risk level based on number of E. coli per 100 mL"
val_lab(hh$Risk_S) = make_labels("
                                 0 Low (<1 per 100 mL)
                                 1 Moderate (1-10 per 100 mL)
                                 2 High (11-100 per 100 mL)
                                 3 Very high (>100 per 100 mL)
                                 9 DK/Missing
                                 ")


hh <- hh %>% mutate(EC_S = 0) %>% mutate(EC_S = ifelse(!Risk_S == 0, 100, 0))
var_lab(hh$EC_S) = "Percentage of household population with  E. coli in source water [1]"


hh <- hh %>% filter(Risk_S <= 3)


hh <- hh %>%
  mutate(impdrinkingWaterSource = ifelse(WS1 %in% 11:14, 11,
                                                    ifelse(WS1 == 21, 12,
                                                           ifelse(WS1 %in% c(31, 41), 13,
                                                                  ifelse(WS1 == 51, 14,
                                                                         ifelse(WS1 == 72, 15,
                                                                                ifelse(WS1 %in% c(61, 71), 16,
                                                                                       ifelse(WS1 %in% 91:92, 17, WS1)))))))) # else WS1?

hh = hh %>% mutate(unimpdrinkingWaterSource = ifelse(WS1 %in% c(32, 42), 21, 22))




hh <- hh %>% mutate(watersource = ifelse(impdrinkingWaterSource %in% 11:17, 10, 
                                         ifelse(unimpdrinkingWaterSource %in% 21:22, 20, NA)))


val_lab(hh$watersource) = make_labels("
  10 Improved sources
  11 Piped water
  12 Tubewell/Borehole
  13 Protected well or spring
  14 Rainwater collection
  15 Water kiosk	  				 
  16 Tanker-truck/Cart will small tank
  17 Bottled/Sachet water
  20 Unimproved sources
  21 Unprotected well or spring
  22 Surface water/Other
                                      ")










```

(come back around to tables all at once to attempt automation / function wrappers etc)


# WS 1.7


```{r}

hh <- read_sav(here("Data/Tunisia_hh.sav")) 

hh = hh %>% mutate(HHAGEx = ifelse(HHAGE %in% 15:19, 1,
                                   ifelse(HHAGE %in% 20:24, 2,
                                          ifelse(HHAGE %in% 25:49, 3,
                                                 ifelse(HHAGE >= 50, 4, HHAGE)))))

var_lab(hh$HHAGEx) = "Age of household head"

hh = hh %>% mutate(HHAGEy = ifelse(HHAGE %in% 15:19, 1,
                                   ifelse(HHAGE %in% 20:24, 2,
                                          ifelse(HHAGE %in% 25:29, 3,
                                                 ifelse(HHAGE %in% 30:34, 4,
                                                        ifelse(HHAGE %in% 35:39, 5, 
                                                               ifelse(HHAGE %in% 40:44, 6,
                                                                      ifelse(HHAGE %in% 45:49, 7,
                                                                             ifelse(HHAGE %in% 50:59, 8,
                                                                                    ifelse(HHAGE %in% 60:69, 9,
                                                                                           ifelse(HHAGE >= 70, 10, HHAGE)))))))))))


var_lab(hh$HHAGEy) = "Age of household head"


hh = hh %>% arrange(HH1, HH2) %>% 
  filter(WQ31 == 1) %>% 
  mutate(wqhweightHH48 = 0) %>% 
  mutate(wqhweightHH48 = ifelse(wqhweight > 0, wqhweight * HH48, wqhweightHH48)) %>% 
  mutate(nhhmem = wqhweightHH48)







hh <- hh %>% mutate(EC_100_H = NA) %>%
  mutate(EC_100_H = ifelse(WQ26 < 998 & WQ26 >= 100, 101,
                           ifelse(WQ26 < 101 | WQ26 >= 997, WQ26, EC_100_H)))




hh <- hh %>% mutate(Risk_H = ifelse(EC_100_H %in% 1:10, 1,
                                    ifelse(EC_100_H %in% 11:100, 2,
                                           ifelse(EC_100_H == 101, 3,
                                                  ifelse(EC_100_H >= 102, 9, EC_100_H)))))


var_lab(hh$EC_100_H) = "Risk level based on number of E. coli per 100 mL"
val_lab(hh$EC_100_H) = make_labels("
                                   0 Low (<1 per 100 mL) 
                                   1 Moderate (1-10 per 100 mL) 
                                   2 High (11-100 per 100 mL) 
                                   3 Very high (>100 per 100 mL) 
                                   9 DK/Missing
                                   ")



hh = hh %>% mutate(EC_H = 0) %>% 
  mutate(EC_H = ifelse(!Risk_H == 0, 100, EC_H))

var_lab(hh$EC_H) = "Percentage of household population with  E. coli in household drinking water [1]"


hh = hh %>% filter(Risk_H <= 3)






hh <- hh %>%
  mutate(impdrinkingWaterSource = ifelse(WS1 %in% 11:14, 11,
                                                    ifelse(WS1 == 21, 12,
                                                           ifelse(WS1 %in% c(31, 41), 13,
                                                                  ifelse(WS1 == 51, 14,
                                                                         ifelse(WS1 == 72, 15,
                                                                                ifelse(WS1 %in% c(61, 71), 16,
                                                                                       ifelse(WS1 %in% 91:92, 17, WS1)))))))) # else WS1?

hh = hh %>% mutate(unimpdrinkingWaterSource = ifelse(WS1 %in% c(32, 42), 21, 22))




hh <- hh %>% mutate(watersource = ifelse(impdrinkingWaterSource %in% 11:17, 10, 
                                         ifelse(unimpdrinkingWaterSource %in% 21:22, 20, NA)))



val_lab(hh$watersource) = make_labels("
  10 Improved sources
  11 Piped water
  12 Tubewell/Borehole
  13 Protected well or spring
  14 Rainwater collection
  15 Water kiosk	  				 
  16 Tanker-truck/Cart will small tank
  17 Bottled/Sachet water
  20 Unimproved sources
  21 Unprotected well or spring
  22 Surface water/Other
                                      ")







```





# WS 1.8

```{r}




hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% arrange(HH1, HH2) %>% 
  filter(WQ31 == 1) %>% 
  mutate(wqsweightHH48 = 0) %>% 
  mutate(wqsweightHH48 = ifelse(wqsweight > 0, wqsweight * HH48, wqsweightHH48)) %>% 
  mutate(nhhmem = wqsweightHH48)

var_lab(hh$nhhmem) = "Number of household members"
source(here("R/drinkingWater.R"))


hh <- hh %>% mutate(EC_100_S = NA) %>% 
  mutate(EC_100_S = ifelse(WQ27 < 997 & WQ27 >= 100, 101,
                           ifelse(WQ27 < 101 | WQ27 >= 997, WQ27, EC_100_S)))

hh <- hh %>% mutate(Risk_S = ifelse(EC_100_S %in% 1:10, 1,
                                      ifelse(EC_100_S %in% 11:100, 2,
                                             ifelse(EC_100_S == 101, 3,
                                                    ifelse(EC_100_S >= 102, 9, EC_100_S)))))


var_lab(hh$Risk_S) = "Risk level based on number of E. coli per 100 mL"
val_lab(hh$Risk_S) = make_labels("
                                 0 Low (<1 per 100 mL)
                                 1 Moderate (1-10 per 100 mL)
                                 2 High (11-100 per 100 mL)
                                 3 Very high (>100 per 100 mL)
                                 9 DK/Missing
                                 ")




hh = hh %>% mutate(WithoutEC_S = 0) %>% 
  mutate(WithoutEC_S = ifelse(Risk_S == 0, 100, WithoutEC_S))


var_lab(hh$WithoutEC_S) = "Without E. coli in drinking water source"


hh <- hh %>% mutate(sufficentwater = 0) %>% 
  mutate(sufficentwater = ifelse(WS7 == 2, 100, sufficentwater))

var_lab(hh$sufficentwater) = "Percentage of household population with drinking water available in sufficient quantities [1]"



hh = hh %>% mutate(wpremises = 0) %>% 
  mutate(wpremises = ifelse(WS1 %in% 11:13 | WS2 %in% 11:13 | WS3 %in% 1:2, 100, wpremises))

var_lab(hh$wpremises) = "Drinking water accessible on premises"



hh = hh %>% mutate(indSDG611 = 0) %>% 
  mutate(indSDG611 = ifelse(drinkingWater == 1 & WithoutEC_S == 100 & sufficentwater == 100 & wpremises == 100, 100, indSDG611))



hh = hh %>% filter(Risk_S <= 3)



hh <- hh %>%
  mutate(impdrinkingWaterSource = ifelse(WS1 %in% 11:14, 11,
                                                    ifelse(WS1 == 21, 12,
                                                           ifelse(WS1 %in% c(31, 41), 13,
                                                                  ifelse(WS1 == 51, 14,
                                                                         ifelse(WS1 == 72, 15,
                                                                                ifelse(WS1 %in% c(61, 71), 16,
                                                                                       ifelse(WS1 %in% 91:92, 17, WS1)))))))) # else WS1?

hh = hh %>% mutate(unimpdrinkingWaterSource = ifelse(WS1 %in% c(32, 42), 21, 22))




hh <- hh %>% mutate(watersource = ifelse(impdrinkingWaterSource %in% 11:17, 10, 
                                         ifelse(unimpdrinkingWaterSource %in% 21:22, 20, NA)))


val_lab(hh$watersource) = make_labels("
  10 Improved sources
  11 Piped water
  12 Tubewell/Borehole
  13 Protected well or spring
  14 Rainwater collection
  15 Water kiosk	  				 
  16 Tanker-truck/Cart will small tank
  17 Bottled/Sachet water
  20 Unimproved sources
  21 Unprotected well or spring
  22 Surface water/Other
                                      ")






```




# WS 1.9

```{r}

hh <- read_sav(here("Data/Tunisia_hh.sav"))

hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")



hh <- hh %>% mutate(treat = 1)
val_lab(hh$treat) = make_labels("
                                1 Water treatment method used in the household
                                ")


hh <- hh %>% mutate(none = 0) %>% 
  mutate(none = ifelse(!WS9 == 1, 100, none))




hh <- hh %>% mutate(boil = ifelse(WS10A == "A", 100, 0)); var_lab(hh$boil) = "Boil"

hh <- hh %>% mutate(bleach = ifelse(WS10B == "B", 100, 0),
                    cloth = ifelse(WS10C == "C", 100, 0),
                    waterFilter = ifelse(WS10D == "D", 100, 0),
                    solar = ifelse(WS10E == "E", 100, 0),
                    stand = ifelse(WS10F == "F", 100, 0),
                    other = ifelse(WS10X == "X", 100, 0),
                    dkmissing = ifelse(WS10Z == "Z" | WS10NR == "?", 100, 0))



source(here("R/drinkingWater.R"))



hh <- hh %>% mutate(appropriate = 0) %>% 
  mutate(appropriate = ifelse(boil == 100 | bleach == 100 | waterFilter == 100 | solar == 100, 100, appropriate))


var_lab(hh$appropriate) = "Percentage of household members in households using an appropriate water treatment method"




var.labs = list(boil = "Boil", bleach = "Add bleach / chlorine", cloth = "Strain through a cloth",
                waterFilter = "Use water filter", solar = "Solar disinfection", stand = "Let it stand and settle", other = "Other", dkmissing = "Dk/Missing")





```




# WS 2.1

```{r}

hh <- read_sav(here("Data/Tunisia_hh.sav"))
hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")


hh <- hh %>% mutate(layer1 = 0,
                    layer2 = 0,
                    fixedobserved = ifelse(HW1 == 1 | HW1 == 2, 100, 0),
                    mobileobserved = ifelse(HW1 == 3, 100, 0),
                    noplace = ifelse(HW1 == 4, 100, 0),
                    nopermission = ifelse(HW1 >= 5, 100, 0))


val_lab(hh$layer1) = make_labels("
                                 0 Handwashing facility observed
                                 ")

val_lab(hh$layer2) = make_labels("
                                 0 Handwashing facility observed and
                                 ")



hh <- hh %>% mutate(numHouseholdsObs = ifelse(fixedobserved == 100 | mobileobserved == 100, 1, 0)) %>% 
  mutate(water = ifelse(HW2 == 1, 100, 0),
         Soap = ifelse(HW7A == "A" | HW7B == "B", 100, 0),
         Ash = ifelse(HW7C == "C", 100, 0),
         numHHObsnoplace = ifelse(fixedobserved == 100 | noplace == 100, 1, 0)) %>% 
  mutate(indWS7 = ifelse(HW2 == 1 & (HW7A == "A" | HW7B == "B"), 100, 0))



var_lab(hh$water) = "water available"; var_lab(hh$Soap) = "soap available"
var_lab(hh$Ash) = "with ash/mud/sand available"

var_lab(hh$indWS7) = "Percentage of household members with handwashing facility where water and soap are present[1]"

val_lab(hh$numHouseholdsObs) = make_labels("
                                           1 Number of household members where handwashing facility was observed
                                           ")



```



# WS 3.1

```{r}


hh <- read_sav(here("Data/Tunisia_hh.sav"))
hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")



source(here("R/drinkingWater.R"))


hh <- hh %>% mutate(WS11 = ifelse(WS11 %in% 97:99, 99, WS11))
val_lab(hh$WS11) = make_labels("
  95  
	99 DK/Missing
                               ")




hh <- hh %>% mutate(improvepercent = ifelse(toiletType == 1, 100, 0)); var_lab(hh$improvepercent) = "Percentage using improved sanitation [1]"

hh = hh %>% mutate(WS14 = ifelse(WS11 == 95, 4, WS14)); var_lab(hh$WS14) = "Location of sanitation facility"
val_lab(hh$WS14) = make_labels("
                               4 Open defecation (no facility, bush, field)
                               ")



var_lab(hh$toiletType) = "Type of sanitation facility used by household"
val_lab(hh$toiletType) = make_labels("
                                     1 Improved sanitation facility
                                     2 Unimproved sanitation facility
                                     3 Open defecation (no facility, bush, field)
                                     ")






```


#WS 3.2

```{r}
hh <- read_sav(here("Data/Tunisia_hh.sav"))

hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")



source(here("R/drinkingWater.R"))



hh = hh %>% mutate(shared1 = ifelse(toiletType == 1, sharedToilet, NA))

var_lab(hh$shared1) = "Users of improved sanitation facilities"
val_lab(hh$shared1) = make_labels("
  0 Not shared [1]
  1 Shared by: 5 households or less
  2 Shared by: More than 5 households
  3 Public facility
  9 DK/Missing
                                  ")


hh = hh %>% mutate(shared2 = ifelse(toiletType == 2, sharedToilet, NA))
var_lab(hh$shared2) = "Users of unimproved sanitation facilities"
val_lab(hh$shared2) = make_labels("
  0 Not shared
  1 Shared by: 5 households or less
  2 Shared by: More than 5 households
  3 Public facility
  9 DK/Missing
                                  ")




hh = hh %>% mutate(shared3 = ifelse(toiletType == 3, 1, NA))

hh = hh %>% mutate(WS14 = ifelse(WS11 == 95, 4, WS14))
var_lab(hh$WS14) = "Location of sanitation facility"






```




#WS 3.3

```{r}

hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% 
  mutate(onsite = ifelse(WS11 == 12, 1,
                         ifelse(WS11 %in% c(13, 21, 22, 31), 2, 0)))

var_lab(hh$onsite) = "Type of onsite sanitation facility"

hh = hh %>% filter(HH46 == 1, !onsite == 0) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")


source(here("R/drinkingWater.R"))

# septic tank

hh <- hh %>% mutate(septicemptiedproviderplant = ifelse(onsite == 1 & WS13 == 1, 100, 0),
                    septicemptiedproviderDK = ifelse(onsite == 1 & WS13 == 3, 100, 0),
                    septicemptiedpit = ifelse(onsite == 1 & (WS13 == 2 | WS13 == 4), 100, 0),
                    septicemptiedHHpit = ifelse(onsite == 1 & WS13 == 5, 100, 0),
                    septicemptiedother = ifelse(onsite == 1 & WS13 == 6, 100, 0),
                    septicemptiedDK = ifelse(onsite == 1 & WS13 == 8, 100, 0),
                    septicneveremptied = ifelse(onsite == 1 & WS12 == 4, 100, 0),
                    septicDKemptied = ifelse(onsite == 1 & WS12 >= 8, 100, 0))

# other improved on-site sanitation facilities
hh <- hh %>% mutate(Oonsiteemptiedproviderplant = ifelse(onsite == 2 & WS13 == 1, 100, 0),
                    OonsiteemptiedproviderDK = ifelse(onsite == 2 & WS13 == 3, 100, 0),
                    Oonsiteemptiedpit = ifelse(onsite == 2 & (WS13 == 2 | WS13 == 4), 100, 0),
                    OonsiteemptiedHHpit = ifelse(onsite == 2 & WS13 == 5, 100, 0),
                    Oonsiteemptiedother = ifelse(onsite == 2 & WS13 == 6, 100, 0),
                    OonsiteemptiedDK = ifelse(onsite == 1 & WS13 == 8, 100, 0),
                    Oonsiteneveremptied = ifelse(onsite == 2 & WS12 == 4, 100, 0),
                    OonsiteDKemptied = ifelse(onsite == 2 & WS12 >= 8, 100, 0))


hh = hh %>% mutate(safedisposal = ifelse(septicemptiedpit == 100 | septicneveremptied == 100 | septicDKemptied == 100 | Oonsiteemptiedpit == 100 |
                                           Oonsiteneveremptied == 100 | OonsiteDKemptied == 100, 100, 0),
                   unsafedisposal = ifelse(septicemptiedHHpit == 100 | septicemptiedother == 100 | OonsiteemptiedHHpit == 100 |
                                             Oonsiteemptiedother == 100, 100, 0),
                   treatment = ifelse(septicemptiedproviderplant == 100 | septicemptiedproviderDK == 100 | septicemptiedDK == 100 | 
                                        Oonsiteemptiedproviderplant == 100 | OonsiteemptiedproviderDK == 100 | OonsiteemptiedDK == 100, 100, 0))


hh = hh %>% mutate(layer1 = 0, layer2 = 0)
hh = hh %>% mutate(WS11c = ifelse(is.na(WS11), 12, WS11))








```


#WS 3.4

```{r}


hh <- read_sav(here("Data/Tunisia_hh.sav"))


source(here("R/commonVarsHH.R"))

hh = hh %>% filter(HH46 == 1) %>% 
  mutate(onsite = ifelse(WS11 == 12, 1,
                         ifelse(WS11 %in% c(13, 21, 22, 31), 2, 0)))


source(here("R/drinkingWater.R"))



hh = hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")



# septic tank

hh <- hh %>% mutate(septicemptiedproviderplant = ifelse(onsite == 1 & WS13 == 1, 100, 0),
                    septicemptiedproviderDK = ifelse(onsite == 1 & WS13 == 3, 100, 0),
                    septicemptiedpit = ifelse(onsite == 1 & (WS13 == 2 | WS13 == 4), 100, 0),
                    septicemptiedHHpit = ifelse(onsite == 1 & WS13 == 5, 100, 0),
                    septicemptiedother = ifelse(onsite == 1 & WS13 == 6, 100, 0),
                    septicemptiedDK = ifelse(onsite == 1 & WS13 == 8, 100, 0),
                    septicneveremptied = ifelse(onsite == 1 & WS12 == 4, 100, 0),
                    septicDKemptied = ifelse(onsite == 1 & WS12 >= 8, 100, 0))

# other improved on-site sanitation facilities
hh <- hh %>% mutate(Oonsiteemptiedproviderplant = ifelse(onsite == 2 & WS13 == 1, 100, 0),
                    OonsiteemptiedproviderDK = ifelse(onsite == 2 & WS13 == 3, 100, 0),
                    Oonsiteemptiedpit = ifelse(onsite == 2 & (WS13 == 2 | WS13 == 4), 100, 0),
                    OonsiteemptiedHHpit = ifelse(onsite == 2 & WS13 == 5, 100, 0),
                    Oonsiteemptiedother = ifelse(onsite == 2 & WS13 == 6, 100, 0),
                    OonsiteemptiedDK = ifelse(onsite == 1 & WS13 == 8, 100, 0),
                    Oonsiteneveremptied = ifelse(onsite == 2 & WS12 == 4, 100, 0),
                    OonsiteDKemptied = ifelse(onsite == 2 & WS12 >= 8, 100, 0))



hh = hh %>% mutate(safedisposal = ifelse(septicemptiedpit == 100 | septicneveremptied == 100 | septicDKemptied == 100 | Oonsiteemptiedpit == 100 |
                                           Oonsiteneveremptied == 100 | OonsiteDKemptied == 100, 100, 0),
                   unsafedisposal = ifelse(septicemptiedHHpit == 100 | septicemptiedother == 100 | OonsiteemptiedHHpit == 100 |
                                             Oonsiteemptiedother == 100, 100, 0),
                   treatment = ifelse(septicemptiedproviderplant == 100 | septicemptiedproviderDK == 100 | septicemptiedDK == 100 | 
                                        Oonsiteemptiedproviderplant == 100 | OonsiteemptiedproviderDK == 100 | OonsiteemptiedDK == 100, 100, 0))



##########


hh = hh %>% mutate(connectedsewer = ifelse(WS11 == 11 | WS11 == 18, 100, 0),
                   usingimproved = ifelse(WS11 %in% c(14, 23, 41, 51, 96), 100, 0),
                   opendefecation = ifelse(WS11 == 95, 100, 0),
                   missingx = ifelse(WS11 > 97, 100, 0))




```





# WS 3.5

```{r}



hh <- read_sav(here("Data/Tunisia_hh.sav"))

source(here("R/drinkingWater.R"))

ch <- read_sav(here("Data/ch.sav"))


hh <- hh %>% left_join(ch, by = c("HH1", "HH2")) %>% filter(UF17 == 1, UB2 < 3)

hh = hh %>% mutate(stools = ifelse(CA31 %in% 1:2, 100, 0),
                   disposalplace = ifelse(CA31 == 98, 99, CA31))



```




# WS 3.6

```{r}


hh <- read_sav(here("Data/Tunisia_hh.sav"))
hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; 
val_lab(hh$nhhmem) = make_labels("
1                        ")



source(here("R/drinkingWater.R"))




hh = hh %>% mutate(drinkingLayer = 0)

hh = hh %>% mutate(drinking = drinkingWater + 1) %>% 
  mutate(drinking = ifelse(WS1 %in% 11:12, 1,
                           ifelse(WS1 %in% c(61, 71) & WS4 <= 30, 1,
                                  ifelse(WS1 %in% c(13:14, 21, 31, 41, 51) & (WS3 %in% 1:2 | WS4 <= 30), 1,
                                         ifelse(WS1 %in% 91:92 & WS2 %in% 11:12, 1,
                                                ifelse(WS1 %in% 91:92 & (WS2 %in% c(61, 71) & WS4 <= 30), 1,
                                                       ifelse(WS1 %in% 91:92 & WS2 %in% c(13,14,21,31,41,51) & (WS3 %in% 1:2 | WS4 <= 30), 1,
                                                              ifelse(WS1 == 81, 4, drinking))))))))

var_lab(hh$drinking) = "Drinking Water"





hh = hh %>% mutate(sanitation = toiletType + 1) %>% 
  mutate(sanitation = ifelse(toiletType == 1 & sharedToilet == 0, 1, sanitation))

var_lab(hh$sanitation) = "Sanitation"

hh = hh %>% mutate(handwashing = 4) %>% 
  mutate(handwashing = ifelse(HW1 <= 3, 2,
                              ifelse(HW1 == 4, 3,
                                     ifelse(HW1 <= 4 & (HW2 == 1 & (HW7A == "A" | HW7B == "B")), 1, handwashing))))



hh = hh %>% mutate(basictotal = ifelse(drinking == 1 & sanitation == 1 & handwashing == 1, 100, 0))



```



# WS 4.1

```{r}




```




