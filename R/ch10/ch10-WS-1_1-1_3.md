Ch10 - WS 1.1 - 1.3
================
Reid Minto
April 22, 2020

1.  Producing two more tables: ws1.2 and ws1.3 as well

2.  Integrate in the code suppression and parenthesizing rules:

<!-- end list -->

1.  Where the unweighted count of the denominator is less than 25 cases
    the value should be suppressed and replaced with an asterisk \*
2.  Where the unweighted count is between 25-49 the values should be
    parenthesized ().

<!-- end list -->

3.  Compile the three tables’ scripts into 1 markdown that can produce
    an SFR chapter (albeit for only 3 tables) in word document

<!-- end list -->

1.  It will be paramount here that the table formatting in the original
    SFR reports are maintained.

<!-- end list -->

``` r
library(tidyverse); library(haven); library(lubridate);
library(knitr); library(kableExtra);
library(Hmisc); library(survey)
library(expss); library(here); library(gmodels)
library(flextable); library(formattable)
library(prettydoc); library(officer)

library(tableone); library(sjPlot); 
```

# Import data

`here` function navigates you to top level Rproj directory

``` r
# haven library called above has read_sav function for reading in .sav / .sps etc
# files from other languages
here()
```

    ## [1] "C:/Users/Owner/Documents/UNICEF-MICS"

``` r
hh <- read_sav(here("Data/Tunisia_hh.sav"))
# hh <- as_factor(hh, only_labelled = TRUE)
```

Filter only cases where hh interview = 1, create a variable
`hhweightHH48` by multiplying `HH48` and `hhweight`, number of hh
members by sample weight

Note: this is just first pass rough draft / run through - much of this
looks like it can be consolidated into a single chunk / a single
function execute per section from what I’ve seen so far, but broken up
in first pass

# 10 - WS.1.1

``` r
hh <- hh %>% filter(HH46 == 1) %>% 
  mutate(hhweightHH48 = HH48 * hhweight) %>% mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; val_lab(hh$nhhmem) = make_labels("
                                                                                     1
                                                                                     ")



var_lab(hh$WS1) = "Source principale d'eau de boisson"
val_lab(hh$WS1) = make_labels("
    11 DANS LE LOGEMENT
    12 DANS LA CONCESSION/JARDIN/ PARCELLE
    13 CHEZ LE VOISIN
    14 ROBIENT PUBLIC/BORNE FONTAINE
    21 PUITS A POMPE/FORAGE
    31 PROTEGE
    32 PAS PROTEGE
    41 SOURCE PROTEGEE
    42 SOURCE NON PROTEGEE
    51 EAU DE PLUIE
    61 CAMION CITERNE
    71 CHARRETTE AVEC PETITE CITERNE
    81 EAU DE SURFACE (RIVIERE, BARRAGE, LAC, MARE, COURANT, CANAL, SYSTEME D’IRRIGATION)
    91 EAU EN BOUTEILLE
    92 EAU EN SACHET
    96 AUTRE
    99 NON REPONSE
                                 ")
############   Begin 10 - WS.sps   ############################
source(here("R/drinkingWater.R"))
                       


############   End 10 - WS.sps   ############################


hh <- hh %>% mutate(improvedWater = ifelse(drinkingWater == 1, 100, 0)) 


var_lab(hh$improvedWater) = "Percentage using improved sources of drinking water [1]"
var_lab(hh$WS1) = ""


hh <- hh %>% mutate(total = 1, total100 = 100)
var_lab(hh$total) = "Total"; var_lab(hh$total100) = "Total"
val_lab(hh$total) = make_labels(" 
                                  1
                                ")
val_lab(hh$total100) = make_labels("
                                   100
                                   ")
```

# 10.1.1 Table

``` r
tab.1.1 = xtabs(nhhmem ~ WS1, hh) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + WS1, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + WS1, hh)) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + WS1, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + WS1, hh))


tab.improved = xtabs(nhhmem ~ improvedWater, hh) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + improvedWater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + improvedWater, hh)) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + improvedWater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + improvedWater, hh))


tab.1.1 = tab.1.1 %>%
  cbind(Total = rowSums(tab.1.1)) %>% 
  cbind(tab.improved[, 2])

N = round(tab.1.1[ , 17])

colnames(tab.1.1)[18] = "Percentage using drinking water from improved sources"



#labels(tabf)[[1]][1] = "Total"
tab.1.1 = apply(tab.1.1, 2, function(x) (x*100) / tab.1.1[, 17])

tab.1.1 <- tab.1.1 %>% cbind(N); colnames(tab.1.1)[18:19] = c("Pourcen-tage utilisant de l'eau de boisson de sources améliorées1", "Nombre de membres des ménages ")

rownames(tab.1.1)[1] = "Total"





# columns are labeled incorrectly 
# SPSS syntax does not match table output, even though I get correct results, they are nested in 
# incorrect value labels / label hierarchies, can fix this as I go, need to investigate though

ind <- c(1, 2, 3, 4, 5, 6, 8, 10, 11, 12, 14, 15, 7, 9, 13, 16, 17)

tab.1.1[ , 1:17] = tab.1.1[ , ind]

colnames(tab.1.1)[1:17] = colnames(tab.1.1)[ind]
```

# SFR 10.1.1

``` r
tab.1.1 %>% 
  kable(digits = 1, format.args = list(big.mark = ",", scientific = FALSE)) %>% 
  kable_styling(c("striped"), font_size = 11) %>% 
#  pack_rows("Total", 1, 1) %>% 
  pack_rows(label(hh$HH6), 2, 3) %>% 
  pack_rows(label(hh$HH7), 4, 10) %>% 
  pack_rows(label(hh$helevel), 11, 15) %>% 
  pack_rows(label(hh$windex5), 16, 20) %>% 
  add_header_above(c(" " , "Eau courante" = 4, " " = 15)) %>% 
  add_header_above(c(" ", "Sources améliorées" = 12, "Sources non améliorées" = 4, " " = 3)) %>% 
  add_header_above(c(" ", "Source principale d'eau de boisson" = 19)) %>% 
  add_header_above(c("Table WS.1.1: Use of improved and unimproved water sources" = 20))
```

<table class="table table-striped" style="font-size: 11px; margin-left: auto; margin-right: auto;">

<thead>

<tr>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="20">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Table WS.1.1: Use of improved and unimproved water sources

</div>

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="1">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="19">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Source principale d’eau de boisson

</div>

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="1">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="12">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Sources améliorées

</div>

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Sources non améliorées

</div>

</th>

<th style="border-bottom:hidden" colspan="3">

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="1">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Eau courante

</div>

</th>

<th style="border-bottom:hidden" colspan="15">

</th>

</tr>

<tr>

<th style="text-align:left;">

</th>

<th style="text-align:right;">

DANS LE LOGEMENT

</th>

<th style="text-align:right;">

DANS LA CONCESSION/JARDIN/ PARCELLE

</th>

<th style="text-align:right;">

CHEZ LE VOISIN

</th>

<th style="text-align:right;">

ROBIENT PUBLIC/BORNE FONTAINE

</th>

<th style="text-align:right;">

PUITS A POMPE/FORAGE

</th>

<th style="text-align:right;">

PROTEGE

</th>

<th style="text-align:right;">

SOURCE PROTEGEE

</th>

<th style="text-align:right;">

EAU DE PLUIE

</th>

<th style="text-align:right;">

CAMION CITERNE

</th>

<th style="text-align:right;">

CHARRETTE AVEC PETITE CITERNE

</th>

<th style="text-align:right;">

EAU EN BOUTEILLE

</th>

<th style="text-align:right;">

EAU EN SACHET

</th>

<th style="text-align:right;">

PAS PROTEGE

</th>

<th style="text-align:right;">

SOURCE NON PROTEGEE

</th>

<th style="text-align:right;">

EAU DE SURFACE (RIVIERE, BARRAGE, LAC, MARE, COURANT, CANAL, SYSTEME
D’IRRIGATION)

</th>

<th style="text-align:right;">

AUTRE

</th>

<th style="text-align:right;">

Total

</th>

<th style="text-align:right;">

Pourcen-tage utilisant de l’eau de boisson de sources améliorées1

</th>

<th style="text-align:right;">

Nombre de membres des ménages

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

Total

</td>

<td style="text-align:right;">

39.1

</td>

<td style="text-align:right;">

2.4

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

2.2

</td>

<td style="text-align:right;">

1.3

</td>

<td style="text-align:right;">

11.4

</td>

<td style="text-align:right;">

2.6

</td>

<td style="text-align:right;">

11.1

</td>

<td style="text-align:right;">

24.6

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.0

</td>

<td style="text-align:right;">

43,638

</td>

</tr>

<tr grouplength="2">

<td colspan="20" style="border-bottom: 1px solid;">

<strong>Area</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

URBAIN

</td>

<td style="text-align:right;">

38.6

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

9.2

</td>

<td style="text-align:right;">

2.1

</td>

<td style="text-align:right;">

12.6

</td>

<td style="text-align:right;">

33.4

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

99.0

</td>

<td style="text-align:right;">

29,853

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

RURAL

</td>

<td style="text-align:right;">

40.0

</td>

<td style="text-align:right;">

6.6

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

4.5

</td>

<td style="text-align:right;">

2.6

</td>

<td style="text-align:right;">

5.3

</td>

<td style="text-align:right;">

2.7

</td>

<td style="text-align:right;">

16.4

</td>

<td style="text-align:right;">

3.7

</td>

<td style="text-align:right;">

7.7

</td>

<td style="text-align:right;">

5.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

1.7

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

95.9

</td>

<td style="text-align:right;">

13,785

</td>

</tr>

<tr grouplength="7">

<td colspan="20" style="border-bottom: 1px solid;">

<strong>Region</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

DISTRICT TUNIS

</td>

<td style="text-align:right;">

32.6

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.9

</td>

<td style="text-align:right;">

15.6

</td>

<td style="text-align:right;">

47.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.2

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.8

</td>

<td style="text-align:right;">

10,398

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD EST

</td>

<td style="text-align:right;">

44.5

</td>

<td style="text-align:right;">

1.7

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

2.0

</td>

<td style="text-align:right;">

1.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

25.2

</td>

<td style="text-align:right;">

22.1

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

99.2

</td>

<td style="text-align:right;">

6,146

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD OUEST

</td>

<td style="text-align:right;">

55.8

</td>

<td style="text-align:right;">

3.9

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

6.0

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

9.2

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

3.8

</td>

<td style="text-align:right;">

11.4

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

5.2

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

93.2

</td>

<td style="text-align:right;">

4,777

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE EST

</td>

<td style="text-align:right;">

34.2

</td>

<td style="text-align:right;">

3.3

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

28.3

</td>

<td style="text-align:right;">

2.4

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

27.3

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.5

</td>

<td style="text-align:right;">

10,289

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE OUEST

</td>

<td style="text-align:right;">

49.3

</td>

<td style="text-align:right;">

5.2

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

5.6

</td>

<td style="text-align:right;">

5.2

</td>

<td style="text-align:right;">

8.2

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

3.3

</td>

<td style="text-align:right;">

6.3

</td>

<td style="text-align:right;">

7.6

</td>

<td style="text-align:right;">

6.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

97.8

</td>

<td style="text-align:right;">

5,584

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD EST

</td>

<td style="text-align:right;">

25.6

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

5.6

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

47.0

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

3.9

</td>

<td style="text-align:right;">

14.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

99.7

</td>

<td style="text-align:right;">

3,957

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD OUEST

</td>

<td style="text-align:right;">

39.3

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

2.2

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

10.7

</td>

<td style="text-align:right;">

33.2

</td>

<td style="text-align:right;">

8.7

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

2.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

97.1

</td>

<td style="text-align:right;">

2,486

</td>

</tr>

<tr grouplength="5">

<td colspan="20" style="border-bottom: 1px solid;">

<strong>Education of household head</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Pre-primary or none

</td>

<td style="text-align:right;">

46.6

</td>

<td style="text-align:right;">

4.7

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

3.1

</td>

<td style="text-align:right;">

1.3

</td>

<td style="text-align:right;">

3.0

</td>

<td style="text-align:right;">

2.6

</td>

<td style="text-align:right;">

9.4

</td>

<td style="text-align:right;">

3.9

</td>

<td style="text-align:right;">

10.6

</td>

<td style="text-align:right;">

9.8

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

96.2

</td>

<td style="text-align:right;">

7,899

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Primary

</td>

<td style="text-align:right;">

43.8

</td>

<td style="text-align:right;">

3.2

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

1.9

</td>

<td style="text-align:right;">

1.6

</td>

<td style="text-align:right;">

3.0

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

13.1

</td>

<td style="text-align:right;">

2.8

</td>

<td style="text-align:right;">

12.2

</td>

<td style="text-align:right;">

14.0

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

97.9

</td>

<td style="text-align:right;">

16,191

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Secondary

</td>

<td style="text-align:right;">

36.1

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

11.1

</td>

<td style="text-align:right;">

2.0

</td>

<td style="text-align:right;">

11.9

</td>

<td style="text-align:right;">

32.5

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.8

</td>

<td style="text-align:right;">

14,179

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Higher

</td>

<td style="text-align:right;">

20.9

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

10.4

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

6.2

</td>

<td style="text-align:right;">

57.9

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

99.0

</td>

<td style="text-align:right;">

5,294

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Missing/DK

</td>

<td style="text-align:right;">

62.5

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

18.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

2.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

17.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

100.0

</td>

<td style="text-align:right;">

75

</td>

</tr>

<tr grouplength="5">

<td colspan="20" style="border-bottom: 1px solid;">

<strong>Wealth index quintile</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Poorest

</td>

<td style="text-align:right;">

28.7

</td>

<td style="text-align:right;">

8.9

</td>

<td style="text-align:right;">

1.8

</td>

<td style="text-align:right;">

7.0

</td>

<td style="text-align:right;">

4.1

</td>

<td style="text-align:right;">

7.4

</td>

<td style="text-align:right;">

4.0

</td>

<td style="text-align:right;">

20.7

</td>

<td style="text-align:right;">

3.9

</td>

<td style="text-align:right;">

6.0

</td>

<td style="text-align:right;">

1.9

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

2.2

</td>

<td style="text-align:right;">

2.6

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

94.3

</td>

<td style="text-align:right;">

8,728

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Second

</td>

<td style="text-align:right;">

47.7

</td>

<td style="text-align:right;">

2.6

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

2.9

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

24.0

</td>

<td style="text-align:right;">

2.5

</td>

<td style="text-align:right;">

11.0

</td>

<td style="text-align:right;">

4.4

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.9

</td>

<td style="text-align:right;">

8,727

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Middle

</td>

<td style="text-align:right;">

56.3

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

9.1

</td>

<td style="text-align:right;">

2.3

</td>

<td style="text-align:right;">

15.6

</td>

<td style="text-align:right;">

13.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.9

</td>

<td style="text-align:right;">

8,726

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Fourth

</td>

<td style="text-align:right;">

45.2

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

2.7

</td>

<td style="text-align:right;">

2.7

</td>

<td style="text-align:right;">

15.3

</td>

<td style="text-align:right;">

32.2

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.2

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

98.8

</td>

<td style="text-align:right;">

8,731

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Richest

</td>

<td style="text-align:right;">

17.5

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

7.6

</td>

<td style="text-align:right;">

71.3

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

99.1

</td>

<td style="text-align:right;">

8,725

</td>

</tr>

</tbody>

</table>

``` r
tab.1.1 %>% 
  kable(format = "latex", digits = 1, format.args = list(big.mark = ",", scientific = FALSE)) %>% 
  kable_styling(c("striped"), font_size = 11) %>% 
#  pack_rows("Total", 1, 1) %>% 
  pack_rows(label(hh$HH6), 2, 3) %>% 
  pack_rows(label(hh$HH7), 4, 10) %>% 
  pack_rows(label(hh$helevel), 11, 15) %>% 
  pack_rows(label(hh$windex5), 16, 20) %>% 
  add_header_above(c(" " , "Eau courante" = 4, " " = 15)) %>% 
  add_header_above(c(" ", "Sources améliorées" = 12, "Sources non améliorées" = 4, " " = 3)) %>% 
  add_header_above(c(" ", "Source principale d'eau de boisson" = 19)) 


a = data.frame(tab.1.1); 

a = lapply(a, function(x) round(x, digits = 1)) %>% data.frame(); colnames(a) = colnames(tab.1.1)
rownames(a) = rownames(tab.1.1)

aa = colnames(a)


ft = flextable(a %>% rownames_to_column(" ")) %>% autofit() %>% 
  fontsize(part = "all", size = 4) %>% bold(part = "header") %>% 
  add_header(`DANS LE LOGEMENT` = "Eau courante",
             `DANS LA CONCESSION/JARDIN/ PARCELLE` = "Eau courante",
             `CHEZ LE VOISIN` = "Eau courante",
             `ROBIENT PUBLIC/BORNE FONTAINE` = "Eau courante") %>% 
  add_header(
  `DANS LE LOGEMENT` = "Sources améliorées",
  `DANS LA CONCESSION/JARDIN/ PARCELLE` = "Sources améliorées",
  `CHEZ LE VOISIN` = "Sources améliorées",
  `ROBIENT PUBLIC/BORNE FONTAINE` = "Sources améliorées", 
  `PUITS A POMPE/FORAGE` = "Sources améliorées",
  `PROTEGE` = "Sources améliorées",
  `SOURCE PROTEGEE` = "Sources améliorées",
  `EAU DE PLUIE` = "Sources améliorées",
  `CAMION CITERNE` = "Sources améliorées",
  `CHARRETTE AVEC PETITE CITERNE` = "Sources améliorées",
  `EAU EN BOUTEILLE` = "Sources améliorées",
  `EAU EN SACHET` = "Sources améliorées",
  `PAS PROTEGE` = "Sources non améliorées",
  `SOURCE NON PROTEGEE` = "Sources non améliorées",
  `EAU DE SURFACE (RIVIERE, BARRAGE, LAC, MARE, COURANT, CANAL, SYSTEME D’IRRIGATION)` = "Sources non améliorées",
  `AUTRE` = "Sources non améliorées"
  ) %>% 
  add_header(
  `DANS LE LOGEMENT` = "Source principale d'eau de boisson",
  `DANS LA CONCESSION/JARDIN/ PARCELLE` = "Source principale d'eau de boisson",
  `CHEZ LE VOISIN` = "Source principale d'eau de boisson",
  `ROBIENT PUBLIC/BORNE FONTAINE` = "Source principale d'eau de boisson", 
  `PUITS A POMPE/FORAGE` = "Source principale d'eau de boisson",
  `PROTEGE` = "Source principale d'eau de boisson",
  `SOURCE PROTEGEE` = "Source principale d'eau de boisson",
  `EAU DE PLUIE` = "Source principale d'eau de boisson",
  `CAMION CITERNE` = "Source principale d'eau de boisson",
  `CHARRETTE AVEC PETITE CITERNE` = "Source principale d'eau de boisson",
  `EAU EN BOUTEILLE` = "Source principale d'eau de boisson",
  `EAU EN SACHET` = "Source principale d'eau de boisson",
  `PAS PROTEGE` = "Source principale d'eau de boisson",
  `SOURCE NON PROTEGEE` = "Source principale d'eau de boisson",
  `EAU DE SURFACE (RIVIERE, BARRAGE, LAC, MARE, COURANT, CANAL, SYSTEME D’IRRIGATION)` = "Source principale d'eau de boisson",
  `AUTRE` = "Source principale d'eau de boisson"
  ) %>% 
  merge_h(i = 1:3, part = "header") %>% 
  theme_zebra() %>% 
  align(align = "center", part = "all") %>% fontsize(part = "header", size = 5)
  #border_inner_v(part = "all", border = fp_border(color = "gray")) %>% fix_border_issues()
 
 
 
 
   

#  add_header(`DANS LE LOGEMENT` = "Eau courante",
#             `DANS LA CONCESSION/JARDIN/ PARCELLE` = "Eau courante",
#             `CHEZ LE VOISIN` = "Eau courante",
#             `ROBIENT PUBLIC/BORNE FONTAINE` = "Eau courante") 

FitFlextableToPage <- function(ft, pgwidth = 8){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}

 FitFlextableToPage(ft, pgwidth = 8)
```

# 10 - WS.1.2

Reminder: change ALL case whens into nested ifelse, case\_when function
just burned me on 1.2 table…

``` r
hh <- read_sav(here("Data/Tunisia_hh.sav"))

hh <- hh %>% filter(HH46 == 1) %>% mutate(hhweightHH48 = HH48 * hhweight) %>% 
  mutate(nhhmem = 1 * hhweightHH48)

var_lab(hh$nhhmem) = "Number of household members"; val_lab(hh$nhhmem) = make_labels("
                                                                                     1
                                                                                     ")
# reload data as start over as in SPS syntax file

hh <- hh %>% mutate(time = ifelse(WS4 %in% 0:30, 2, 
                                  ifelse(WS4 %in% 31:990, 3,
                                         ifelse(WS4 %in% c(998, 999), 9,
                                                WS4)))) %>% 
  mutate(time = ifelse(WS1 %in% 11:13 |
                         WS2 %in% 11:13 |
                         WS3 %in% 1:2, 1, time))




var_lab(hh$time) = "Time to source of drinking water"; val_lab(hh$time) = make_labels(" 
    1 Water on premises
    2 Up to and including 30 minutes [A]
    3 More than 30 minutes
    9 DK/Missing
    ")


#####################      BEGIN 10 - WS.SPS    ################################

source(here("R/drinkingWater.R"))

#####################     END 10 - WS.SPS      ################################

var_lab(hh$drinkingWater) = "Time to source of drinking Water"
val_lab(hh$drinkingWater) = make_labels("
      1 Users of improved drinking water sources 
      2 Users of unimproved drinking water sources
                                        ")

hh <- hh %>% 
  mutate(INDWS2 = 0) %>% 
  mutate(INDWS2 = case_when(
    WS1 %in% c(11, 12) ~ 100,
    (WS1 %in% c(61, 71, 72)) & (WS4 <= 30) ~ 100,
    (WS1 %in% c(13, 14, 21, 31, 41, 51)) & (WS3 %in% 1:2 | WS4 <= 30) ~ 100,
    (WS1 %in% 91:92) & (WS2 %in% 11:12) ~ 100,
    (WS1 %in% 91:92) & (WS2 %in% c(61, 71, 72) & WS4 <= 30) ~ 100,
    (WS1 %in% 91:92) & (WS2 %in% c(13, 14, 21, 31, 41, 51)) & (WS3 %in% 1:2 | WS4 <= 30) ~ 100
  )  )

hh$total = 1
var_lab(hh$INDWS2) = "Percentage using basic drinking water services [1]"
var_lab(hh$total) = "Total"; val_lab(hh$total) = make_labels("
                                                             1 
                                                             ")
```

## 10.1.2 Tables

The general code process for creating the tables in R is as follows:
(there may be a more clever way to do this in one table command, but
this works for now)

Each `xtabs` command computes a contingency table We go group by group -
so e.g. starting off with contingency table of `HH6` (Area) vs. `WS1`
(drinking water source) , or for 1.2 Area vs `time`

This one `xtabs` command is a single building block in our SFR table, we
then stack these downwards using the `rbind` command in R, which
“rowbinds” blocks together.

Naturally - Using `rbind` to rowbind two objects together (table /
dataframe / list etc) requires exact same columns in each object,
similarly `cbind` (column binding) two objects requires exact same rows

We rowbind together downwards - `HH6` - Area, `HH7` Region, `helevel`
education level, and `windex5` wealth quintile. For the table here in
1.2, there’s an additional step of performing this sequence on a
filtered dataframe for `drinkingWater == 1`, then using `cbind` to bind
together the same table but for `drinkingWater == 2`

``` r
df.unweighted <- hh %>% dplyr::summarize(Count = sum(HH48)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(HH6)) %>% 
                     dplyr::summarize(Count = sum(HH48)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(HH7)) %>% 
                     dplyr::summarize(Count = sum(HH48)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(helevel)) %>% 
                     dplyr::summarize(Count = sum(HH48)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(windex5)) %>% 
                     dplyr::summarize(Count = sum(HH48)) %>% select(Count)); 

df.unweighted$Count = round(df.unweighted$Count); 
rownames(df.unweighted) = c("Total", levels(as_factor(hh$HH6)), levels(as_factor(hh$HH7)), levels(as_factor(hh$helevel)), 
                levels(as_factor(hh$windex5)))
```

    ## Warning: Setting row names on a tibble is deprecated.

``` r
# to be turned into function - this is likely common task in every chapter...
N <- hh %>% dplyr::summarize(Count = sum(nhhmem)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(HH6)) %>% 
                     dplyr::summarize(Count = sum(nhhmem)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(HH7)) %>% 
                     dplyr::summarize(Count = sum(nhhmem)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(helevel)) %>% 
                     dplyr::summarize(Count = sum(nhhmem)) %>% select(Count)) %>% 
  rbind.data.frame(hh %>% group_by(as_factor(windex5)) %>% 
                     dplyr::summarize(Count = sum(nhhmem)) %>% select(Count))

N$Count = round(N$Count)
N <- N %>% mutate(Total = Count)
N <- data.frame(N); colnames(N)[1] = c("Number of household members")
rownames(N) = c("Total", levels(as_factor(hh$HH6)), levels(as_factor(hh$HH7)), levels(as_factor(hh$helevel)), 
                levels(as_factor(hh$windex5)))




tab.improved = xtabs(nhhmem ~ as_factor(time), hh %>% filter(drinkingWater == 1)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + as_factor(time), hh %>% filter(drinkingWater == 1))) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + as_factor(time), hh %>% filter(drinkingWater == 1))) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + as_factor(time), hh %>% filter(drinkingWater == 1))) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + as_factor(time), hh %>% filter(drinkingWater == 1)))


tab.unimproved = xtabs(nhhmem ~ as_factor(time), hh %>% filter(drinkingWater == 2)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + as_factor(time), hh %>% filter(drinkingWater == 2))) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + as_factor(time), hh %>% filter(drinkingWater == 2))) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + as_factor(time), hh %>% filter(drinkingWater == 2))) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + as_factor(time), hh %>% filter(drinkingWater == 2)))


tab.basic = xtabs(nhhmem ~ as_factor(INDWS2), hh) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + as_factor(INDWS2), hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + as_factor(INDWS2), hh)) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + as_factor(INDWS2), hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + as_factor(INDWS2), hh))


tab.1.2 = cbind(tab.improved, tab.unimproved, N$Total, tab.basic, N$`Number of household members`)



tab.1.2 = apply(tab.1.2[ , 1:(ncol(tab.1.2)-1)], 2, function(x) (x * 100) / tab.1.2[ , ncol(tab.1.2) - 2]) %>% cbind(N$`Number of household members`)

colnames(tab.1.2)[(ncol(tab.1.2) - 2):ncol(tab.1.2)] = c("Total",
                            "Percentage using basic drinking water services [1]",
                            "Number of household members")



rownames(tab.1.2)[1] = "Total"
```

### parenth function

``` r
# inputs - df is the dataframe in which we want to suppress values / apply rule
# N is the vector of unweighted samples

samp_check_fun <- function(df, N, inds) {
  ind = ifelse(N[,1] < 25, 1, 
               ifelse(N[,1] %in% 25:49, 2,
                      3))
  
  
  
  df[ind == 1, inds] = "*"
  df[ind == 2, inds] = paste0("(", format(unlist(df[ind == 2, inds])), ")")
  
  
  
  
}


ind = ifelse(df.unweighted$Count < 25, 1, 
               ifelse(df.unweighted$Count %in% 25:49, 2,
                      3))
```

# SFR 10.1.2

``` r
header1 = label(hh$time)

tab.1.2 %>% 
  kable(digits = 1, format.args = list(big.mark = ",", scientific = FALSE)) %>% 
  kable_styling(c("striped"), font_size = 12) %>% 
  pack_rows(label(hh$HH6), 2, 3) %>% 
  pack_rows(label(hh$HH7), 4, 10) %>% 
  pack_rows(label(hh$helevel), 11, 15) %>% 
  pack_rows(label(hh$windex5), 16, 20) %>% 
  add_header_above(c(" ", "Users of improved drinking water sources" = 4, 
                     "Users of unimproved drinking water sources" = 4,
                     " " = 3)) %>% 
  add_header_above(c(" ", "Time to source of drinking water" = 8, " " = 3)) %>% 
  add_header_above(c("Tableau WS.1.2: Utilisation des services d'eau de boisson de base et limités" = 12))
```

<table class="table table-striped" style="font-size: 12px; margin-left: auto; margin-right: auto;">

<thead>

<tr>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="12">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Tableau WS.1.2: Utilisation des services d’eau de boisson de base et
limités

</div>

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="1">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="8">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Time to source of drinking water

</div>

</th>

<th style="border-bottom:hidden" colspan="3">

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="1">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Users of improved drinking water sources

</div>

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Users of unimproved drinking water sources

</div>

</th>

<th style="border-bottom:hidden" colspan="3">

</th>

</tr>

<tr>

<th style="text-align:left;">

</th>

<th style="text-align:right;">

Water on premises

</th>

<th style="text-align:right;">

Up to and including 30 minutes \[A\]

</th>

<th style="text-align:right;">

More than 30 minutes

</th>

<th style="text-align:right;">

DK/Missing

</th>

<th style="text-align:right;">

Water on premises

</th>

<th style="text-align:right;">

Up to and including 30 minutes \[A\]

</th>

<th style="text-align:right;">

More than 30 minutes

</th>

<th style="text-align:right;">

DK/Missing

</th>

<th style="text-align:right;">

Total

</th>

<th style="text-align:right;">

Percentage using basic drinking water services \[1\]

</th>

<th style="text-align:right;">

Number of household members

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

Total

</td>

<td style="text-align:right;">

86.6

</td>

<td style="text-align:right;">

9.1

</td>

<td style="text-align:right;">

2.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

1.0

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

85.9

</td>

<td style="text-align:right;">

43,638

</td>

</tr>

<tr grouplength="2">

<td colspan="12" style="border-bottom: 1px solid;">

<strong>Area</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

URBAIN

</td>

<td style="text-align:right;">

91.4

</td>

<td style="text-align:right;">

6.8

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

86.4

</td>

<td style="text-align:right;">

29,853

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

RURAL

</td>

<td style="text-align:right;">

76.3

</td>

<td style="text-align:right;">

14.1

</td>

<td style="text-align:right;">

5.3

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

1.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

84.6

</td>

<td style="text-align:right;">

13,785

</td>

</tr>

<tr grouplength="7">

<td colspan="12" style="border-bottom: 1px solid;">

<strong>Region</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

DISTRICT TUNIS

</td>

<td style="text-align:right;">

94.5

</td>

<td style="text-align:right;">

4.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

84.4

</td>

<td style="text-align:right;">

10,398

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD EST

</td>

<td style="text-align:right;">

94.7

</td>

<td style="text-align:right;">

3.8

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

74.8

</td>

<td style="text-align:right;">

6,146

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD OUEST

</td>

<td style="text-align:right;">

77.6

</td>

<td style="text-align:right;">

10.5

</td>

<td style="text-align:right;">

5.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

3.7

</td>

<td style="text-align:right;">

2.3

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

85.0

</td>

<td style="text-align:right;">

4,777

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE EST

</td>

<td style="text-align:right;">

86.1

</td>

<td style="text-align:right;">

11.3

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

96.8

</td>

<td style="text-align:right;">

10,289

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE OUEST

</td>

<td style="text-align:right;">

71.5

</td>

<td style="text-align:right;">

17.1

</td>

<td style="text-align:right;">

9.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.0

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

83.7

</td>

<td style="text-align:right;">

5,584

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD EST

</td>

<td style="text-align:right;">

90.6

</td>

<td style="text-align:right;">

7.5

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

95.3

</td>

<td style="text-align:right;">

3,957

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD OUEST

</td>

<td style="text-align:right;">

81.0

</td>

<td style="text-align:right;">

15.3

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

2.4

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

65.2

</td>

<td style="text-align:right;">

2,486

</td>

</tr>

<tr grouplength="5">

<td colspan="12" style="border-bottom: 1px solid;">

<strong>Education of household head</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Pre-primary or none

</td>

<td style="text-align:right;">

81.4

</td>

<td style="text-align:right;">

10.5

</td>

<td style="text-align:right;">

4.2

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

1.4

</td>

<td style="text-align:right;">

1.5

</td>

<td style="text-align:right;">

0.8

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

82.8

</td>

<td style="text-align:right;">

7,899

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Primary

</td>

<td style="text-align:right;">

84.5

</td>

<td style="text-align:right;">

10.9

</td>

<td style="text-align:right;">

2.3

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

1.0

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.5

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

84.7

</td>

<td style="text-align:right;">

16,191

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Secondary

</td>

<td style="text-align:right;">

89.8

</td>

<td style="text-align:right;">

7.5

</td>

<td style="text-align:right;">

1.2

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

1.0

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

86.6

</td>

<td style="text-align:right;">

14,179

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Higher

</td>

<td style="text-align:right;">

92.3

</td>

<td style="text-align:right;">

5.8

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.7

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

92.1

</td>

<td style="text-align:right;">

5,294

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Missing/DK

</td>

<td style="text-align:right;">

82.3

</td>

<td style="text-align:right;">

12.2

</td>

<td style="text-align:right;">

5.9

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

94.5

</td>

<td style="text-align:right;">

75

</td>

</tr>

<tr grouplength="5">

<td colspan="12" style="border-bottom: 1px solid;">

<strong>Wealth index quintile</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Poorest

</td>

<td style="text-align:right;">

67.6

</td>

<td style="text-align:right;">

18.8

</td>

<td style="text-align:right;">

7.5

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

1.7

</td>

<td style="text-align:right;">

2.2

</td>

<td style="text-align:right;">

1.7

</td>

<td style="text-align:right;">

0.1

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

81.8

</td>

<td style="text-align:right;">

8,728

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Second

</td>

<td style="text-align:right;">

84.4

</td>

<td style="text-align:right;">

12.4

</td>

<td style="text-align:right;">

1.9

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.6

</td>

<td style="text-align:right;">

0.4

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

88.0

</td>

<td style="text-align:right;">

8,727

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Middle

</td>

<td style="text-align:right;">

89.9

</td>

<td style="text-align:right;">

7.8

</td>

<td style="text-align:right;">

1.0

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.3

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

83.8

</td>

<td style="text-align:right;">

8,726

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Fourth

</td>

<td style="text-align:right;">

94.0

</td>

<td style="text-align:right;">

4.6

</td>

<td style="text-align:right;">

0.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

1.2

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

84.3

</td>

<td style="text-align:right;">

8,731

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Richest

</td>

<td style="text-align:right;">

97.1

</td>

<td style="text-align:right;">

2.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.9

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

0.0

</td>

<td style="text-align:right;">

100

</td>

<td style="text-align:right;">

91.5

</td>

<td style="text-align:right;">

8,725

</td>

</tr>

</tbody>

</table>

``` r
a = data.frame(tab.1.2); 

a = lapply(a, function(x) round(x, digits = 1)) %>% data.frame(); colnames(a) = colnames(tab.1.2)
rownames(a) = rownames(tab.1.2)
colnames(a)[5:8] = c(" Water on premises", " Up to and including 30 minutes [A]",
                     " More than 30 minutes", " DK/Missing")
aa = colnames(a)


ft = flextable(a %>% rownames_to_column(" ")) %>% autofit() %>% 
  fontsize(part = "all", size = 4) %>% bold(part = "header") %>% 
  add_header(`Water on premises` = "Users of improved drinking water sources",
             `Up to and including 30 minutes [A]` = "Users of improved drinking water sources",
             `More than 30 minutes` = "Users of improved drinking water sources",
             `DK/Missing` = "Users of improved drinking water sources",
             ` Water on premises` = "Users of unimproved drinking water sources",
             ` Up to and including 30 minutes [A]` = "Users of unimproved drinking water sources",
             ` More than 30 minutes` = "Users of unimproved drinking water sources",
             ` DK/Missing` = "Users of unimproved drinking water sources") %>% 
add_header(
             `Water on premises` = "Time to source of drinking water",
             `Up to and including 30 minutes [A]` = "Time to source of drinking water",
             `More than 30 minutes` = "Time to source of drinking water",
             `DK/Missing` = "Time to source of drinking water",
             ` Water on premises` = "Time to source of drinking water",
             ` Up to and including 30 minutes [A]` = "Time to source of drinking water",
             ` More than 30 minutes` = "Time to source of drinking water",
             ` DK/Missing` = "Time to source of drinking water"
) %>% 
  merge_h(i = 1:3, part = "header") %>% 
  theme_zebra() %>% 
  align(align = "center", part = "all") %>% fontsize(part = "header", size = 5)
  #border_inner_v(part = "all", border = fp_border(color = "gray")) %>% fix_border_issues()
 
 
 
 
   

#  add_header(`DANS LE LOGEMENT` = "Eau courante",
#             `DANS LA CONCESSION/JARDIN/ PARCELLE` = "Eau courante",
#             `CHEZ LE VOISIN` = "Eau courante",
#             `ROBIENT PUBLIC/BORNE FONTAINE` = "Eau courante") 

FitFlextableToPage <- function(ft, pgwidth = 8){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}

 FitFlextableToPage(ft, pgwidth = 8)
```

# flextables experimentation

``` r
a = data.frame(tab.1.1); 

a = lapply(a, function(x) round(x, digits = 1)) %>% data.frame(); colnames(a) = colnames(tab.1.1)
rownames(a) = rownames(tab.1.1)

flextable(a %>% rownames_to_column("a"), col_keys = names(a)) %>% autofit() %>% 
  add_header_lines("Users of improved drinking water sources") %>% 
  fontsize(part = "header", size = 14) %>% bold(part = "header") %>% 
  border_inner_v(border = fp_border(color = "gray"), part = "all")


aa = colnames(a)

flextable(a %>% rownames_to_column(" ")) %>% autofit() %>% 
  fontsize(part = "header", size = 10) %>% bold(part = "header") %>% 
  fontsize(part = "body", size = 7) %>% 
  add_header(`DANS LE LOGEMENT` = "Eau courante") %>% 
  merge_at(i = 1, j = 2:4, part = "header") %>% 
  add_header(`PROTEGE` = "Sources améliorées",
             `AUTRE` = "Sources non améliorées") %>% 
 # merge_at(i = 1, j = 5:12, part = "header") %>% 
  add_header(`CAMION CITERNE` = "Source principale d'eau de boisson") %>% 
  border_inner_v(border = fp_border(color = "gray")) %>% theme_zebra()
```

``` r
flextable(a) %>% set_header_df(mapping = b, key = "col_keys")

ft <- flextable( head( iris ) ); ft
ft <- add_footer_lines(ft, values = "blah blah"); ft
ft <- add_footer_lines(ft, values = c("blah 1", "blah 2"))
autofit(ft)
ft <- flextable( head( iris ) ); ft
ft <- add_header_lines(ft, values = "blah blah"); ft
ft <- add_header_lines(ft, values = c("blah 1", "blah 2")); ft
autofit(ft)
```

``` r
atypology <- data.frame(
  col_keys = colnames(a),
  what = c(rep("a", 4), rep(" ", 15)), stringsAsFactors = FALSE)


typology <- data.frame(
  col_keys = c( "Sepal.Length", "Sepal.Width", "Petal.Length",
                "Petal.Width", "Species" ),
  what = c("Sepal", "Sepal", "Petal", "Petal", "Species"),
  measure = c("Length", "Width", "Length", "Width", "Species"),
  stringsAsFactors = FALSE )

ft <- flextable( head( iris ))
ft <- set_header_df(ft, mapping = typology, key = "col_keys" )
ft <- merge_h(ft, part = "header")
ft <- merge_v(ft, j = "Species", part = "header")
ft <- theme_vanilla(ft)
ft

typology <- data.frame(
  col_keys = c( "Sepal.Length", "Sepal.Width", "Petal.Length",
                "Petal.Width", "Species" ),
  unit = c("(cm)", "(cm)", "(cm)", "(cm)", ""),
  stringsAsFactors = FALSE )
ft <- set_footer_df(ft, mapping = typology, key = "col_keys" )
ft <- italic(ft, italic = TRUE, part = "footer" )
ft <- theme_booktabs(ft)
ft
```

# 10 - WS.1.3

``` r
hl <- read_sav(here("Data/Tunisia_hl.sav"))
hh <- read_sav(here("Data/Tunisia_hh.sav")) %>% arrange(HH1, HH2)
```

``` r
hl <- hl %>% mutate(personcwater = 9) %>% 
  mutate(personcwater = ifelse(HL4 == 2 & HL6 >= 15 & HL6 <= 95, 1,
                               ifelse(HL4 == 1 & HL6 >= 15 & HL6 <= 95, 2,
                                      ifelse(HL4 == 2 & HL6 <= 14, 3,
                                             ifelse(HL4 == 1 & HL6 <= 14, 4,
                                                    personcwater)))))

var_lab(hl$personcwater) = "Person usually collecting drinking water"
val_lab(hl$personcwater) = make_labels("
1 Woman (15+)
2 Man (15+)
3 Female child under age 15
4 Male child under age 15
9 DK/Missing/Members do not collect
                                       ")
hl <- hl %>% select(HH1, HH2, HL1, personcwater) %>% rename(WS5 = HL1)

hh = hh %>% left_join(hl, by = c("HH1", "HH2", "WS5"))
```

    ## Warning: Column `WS5` has different attributes on LHS and RHS of join

``` r
hh <- hh %>% mutate(personcwater = ifelse(WS4 == 0, 9,
                                          ifelse(WS5 == 0 | WS5 > 90, 9,
                                                 personcwater)))

var_lab(hh$personcwater) = "Person usually collecting drinking water"
val_lab(hh$personcwater) = make_labels("
1 Woman (15+)
2 Man (15+)
3 Female child under age 15
4 Male child under age 15
9 DK/Missing/Members do not collect
                                       ")

hh <- hh %>% filter(HH46 == 1) %>% mutate(hhweightHH48 = HH48 * hhweight) %>%
  mutate(nhhmem = 1 * hhweightHH48)
var_lab(hh$nhhmem) = "Number of household members"; val_lab(hh$nhhmem) = make_labels("1 ")


hh <- hh %>% mutate(withoutWater = 0) %>% mutate(withoutWater = ifelse(!is.na(WS4), 100, withoutWater))

var_lab(hh$withoutWater) = "Percentage of household members without drinking water on premises"


hh <- hh %>% mutate(nhhmemwithoutWater = ifelse(!is.na(WS4), 1, 0))

source(here("R/drinkingWater.R"))
```

``` r
source(here("R/denoms.R"))


tab.collecting = xtabs(nhhmem ~ personcwater, hh) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + personcwater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + personcwater, hh)) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + personcwater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + personcwater, hh)) 



tab.without <- xtabs(nhhmem ~ withoutWater, hh) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH6) + withoutWater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(HH7) + withoutWater, hh)) %>%
  rbind(xtabs(nhhmem ~ as_factor(helevel) + withoutWater, hh)) %>% 
  rbind(xtabs(nhhmem ~ as_factor(windex5) + withoutWater, hh)); tab.without = round(tab.without[,2])


tab <- cbind(tab.without, N$Count, tab.collecting, tab.without, tab.without)
rownames(tab)[1] = "Total"; 

tab[, 1] = (100 * tab[,1]) / tab[, 2]

tab[,3:8] = (100 * tab[,3:8]) / tab[, 9]





labs = c(label(hh$withoutWater), label(hh$nhhmem), levels(as_factor(hh$personcwater)), "Total",
         "Number of household members without drinking water on site")
tab.1.3 = tab

colnames(tab.1.3) = labs




denom = tab.1.3[, 9]
ind = ifelse(denom < 25, 1, 
               ifelse(denom %in% 25:49, 2,
                      3))

tab.1.3[ , c(1,3:7)] = apply(tab[, c(1, 3:7)], 2, function(x) round(x, digits = 1))
tab.1.3[, c(2, 8, 9)] = apply(tab[, c(2, 8, 9)], 2, function(x) formatC(x, format = "d", big.mark = ","))

tab.1.3[ind == 1, 3:7] = "(*)"
```

# SFR Table 10.1.3

``` r
labp = label(hh$personcwater)




tab.1.3 %>% 
  kable(digits = 1, format.args = list(big.mark = ",", scientific = FALSE)) %>% 
  kable_styling(c("striped"), font_size = 10) %>% 
  pack_rows(label(hh$HH6), 2, 3) %>% 
  pack_rows(label(hh$HH7), 4, 10) %>% 
  pack_rows(label(hh$helevel), 11, 15) %>% 
  pack_rows(label(hh$windex5), 16, 20) %>% 
  kableExtra::add_header_above(c(" " = 3, "Person usually collecting drinking water" = 5, " " = 2)) %>% 
  add_header_above(c("
Table WS.1.3: Person collecting water" = 10))
```

<table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">

<thead>

<tr>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="10">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

<br>Table WS.1.3: Person collecting water

</div>

</th>

</tr>

<tr>

<th style="border-bottom:hidden" colspan="3">

</th>

<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">

<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">

Person usually collecting drinking water

</div>

</th>

<th style="border-bottom:hidden" colspan="2">

</th>

</tr>

<tr>

<th style="text-align:left;">

</th>

<th style="text-align:left;">

Percentage of household members without drinking water on premises

</th>

<th style="text-align:left;">

Number of household members

</th>

<th style="text-align:left;">

Woman (15+)

</th>

<th style="text-align:left;">

Man (15+)

</th>

<th style="text-align:left;">

Female child under age 15

</th>

<th style="text-align:left;">

Male child under age 15

</th>

<th style="text-align:left;">

DK/Missing/Members do not collect

</th>

<th style="text-align:left;">

Total

</th>

<th style="text-align:left;">

Number of household members without drinking water on site

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

Total

</td>

<td style="text-align:left;">

12.7

</td>

<td style="text-align:left;">

43,638

</td>

<td style="text-align:left;">

33.5

</td>

<td style="text-align:left;">

36.5

</td>

<td style="text-align:left;">

0.7

</td>

<td style="text-align:left;">

0.8

</td>

<td style="text-align:left;">

28.4

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

5,539

</td>

</tr>

<tr grouplength="2">

<td colspan="10" style="border-bottom: 1px solid;">

<strong>Area</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

URBAIN

</td>

<td style="text-align:left;">

7.9

</td>

<td style="text-align:left;">

29,853

</td>

<td style="text-align:left;">

28.3

</td>

<td style="text-align:left;">

32.5

</td>

<td style="text-align:left;">

0.6

</td>

<td style="text-align:left;">

0.6

</td>

<td style="text-align:left;">

38

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

2,348

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

RURAL

</td>

<td style="text-align:left;">

23.1

</td>

<td style="text-align:left;">

13,785

</td>

<td style="text-align:left;">

37.3

</td>

<td style="text-align:left;">

39.5

</td>

<td style="text-align:left;">

0.8

</td>

<td style="text-align:left;">

1

</td>

<td style="text-align:left;">

21.4

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

3,191

</td>

</tr>

<tr grouplength="7">

<td colspan="10" style="border-bottom: 1px solid;">

<strong>Region</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

DISTRICT TUNIS

</td>

<td style="text-align:left;">

4.4

</td>

<td style="text-align:left;">

10,398

</td>

<td style="text-align:left;">

7.5

</td>

<td style="text-align:left;">

11.6

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

80.9

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

458

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD EST

</td>

<td style="text-align:left;">

4.9

</td>

<td style="text-align:left;">

6,146

</td>

<td style="text-align:left;">

32

</td>

<td style="text-align:left;">

26.3

</td>

<td style="text-align:left;">

0.7

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

41

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

303

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

NORD OUEST

</td>

<td style="text-align:left;">

23.1

</td>

<td style="text-align:left;">

4,777

</td>

<td style="text-align:left;">

41.3

</td>

<td style="text-align:left;">

51.1

</td>

<td style="text-align:left;">

0.9

</td>

<td style="text-align:left;">

0.6

</td>

<td style="text-align:left;">

6.2

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,104

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE EST

</td>

<td style="text-align:left;">

12.8

</td>

<td style="text-align:left;">

10,289

</td>

<td style="text-align:left;">

46

</td>

<td style="text-align:left;">

35

</td>

<td style="text-align:left;">

1.5

</td>

<td style="text-align:left;">

1.1

</td>

<td style="text-align:left;">

16.4

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,322

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

CENTRE OUEST

</td>

<td style="text-align:left;">

28

</td>

<td style="text-align:left;">

5,584

</td>

<td style="text-align:left;">

23.1

</td>

<td style="text-align:left;">

46.4

</td>

<td style="text-align:left;">

0.3

</td>

<td style="text-align:left;">

1.6

</td>

<td style="text-align:left;">

28.5

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,562

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD EST

</td>

<td style="text-align:left;">

9.4

</td>

<td style="text-align:left;">

3,957

</td>

<td style="text-align:left;">

67.9

</td>

<td style="text-align:left;">

25.8

</td>

<td style="text-align:left;">

1.2

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

5.3

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

371

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

SUD OUEST

</td>

<td style="text-align:left;">

16.9

</td>

<td style="text-align:left;">

2,486

</td>

<td style="text-align:left;">

11.1

</td>

<td style="text-align:left;">

10.3

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

78.5

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

419

</td>

</tr>

<tr grouplength="5">

<td colspan="10" style="border-bottom: 1px solid;">

<strong>Education of household head</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Pre-primary or none

</td>

<td style="text-align:left;">

18

</td>

<td style="text-align:left;">

7,899

</td>

<td style="text-align:left;">

35.8

</td>

<td style="text-align:left;">

39.5

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0.2

</td>

<td style="text-align:left;">

24.4

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,419

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Primary

</td>

<td style="text-align:left;">

15

</td>

<td style="text-align:left;">

16,191

</td>

<td style="text-align:left;">

36.5

</td>

<td style="text-align:left;">

33.4

</td>

<td style="text-align:left;">

0.9

</td>

<td style="text-align:left;">

1.2

</td>

<td style="text-align:left;">

28

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

2,422

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Secondary

</td>

<td style="text-align:left;">

9.3

</td>

<td style="text-align:left;">

14,179

</td>

<td style="text-align:left;">

28.7

</td>

<td style="text-align:left;">

35.7

</td>

<td style="text-align:left;">

1.4

</td>

<td style="text-align:left;">

1.1

</td>

<td style="text-align:left;">

33.1

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,312

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Higher

</td>

<td style="text-align:left;">

7

</td>

<td style="text-align:left;">

5,294

</td>

<td style="text-align:left;">

23

</td>

<td style="text-align:left;">

45.7

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

31.3

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

373

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Missing/DK

</td>

<td style="text-align:left;">

18.7

</td>

<td style="text-align:left;">

75

</td>

<td style="text-align:left;">

(\*)

</td>

<td style="text-align:left;">

(\*)

</td>

<td style="text-align:left;">

(\*)

</td>

<td style="text-align:left;">

(\*)

</td>

<td style="text-align:left;">

(\*)

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

14

</td>

</tr>

<tr grouplength="5">

<td colspan="10" style="border-bottom: 1px solid;">

<strong>Wealth index quintile</strong>

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Poorest

</td>

<td style="text-align:left;">

32.2

</td>

<td style="text-align:left;">

8,728

</td>

<td style="text-align:left;">

41.1

</td>

<td style="text-align:left;">

38.8

</td>

<td style="text-align:left;">

1

</td>

<td style="text-align:left;">

1.1

</td>

<td style="text-align:left;">

18

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

2,808

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Second

</td>

<td style="text-align:left;">

15.2

</td>

<td style="text-align:left;">

8,727

</td>

<td style="text-align:left;">

37.3

</td>

<td style="text-align:left;">

38.6

</td>

<td style="text-align:left;">

1.1

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

23.1

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

1,329

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Middle

</td>

<td style="text-align:left;">

9.2

</td>

<td style="text-align:left;">

8,726

</td>

<td style="text-align:left;">

20.3

</td>

<td style="text-align:left;">

39.7

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

40

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

805

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Fourth

</td>

<td style="text-align:left;">

4.8

</td>

<td style="text-align:left;">

8,731

</td>

<td style="text-align:left;">

8.2

</td>

<td style="text-align:left;">

13.1

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

3.4

</td>

<td style="text-align:left;">

75.4

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

416

</td>

</tr>

<tr>

<td style="text-align:left; padding-left: 2em;" indentlevel="1">

Richest

</td>

<td style="text-align:left;">

2.1

</td>

<td style="text-align:left;">

8,725

</td>

<td style="text-align:left;">

4.2

</td>

<td style="text-align:left;">

26.6

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

0

</td>

<td style="text-align:left;">

69.1

</td>

<td style="text-align:left;">

100

</td>

<td style="text-align:left;">

181

</td>

</tr>

</tbody>

</table>
